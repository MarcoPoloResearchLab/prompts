# Docker Compose for Prompt Bubbles Development with TAuth Authentication
#
# Usage:
#   1. Copy .env.frontend.example to .env.frontend and configure
#   2. Copy .env.tauth.example to .env.tauth and configure
#   3. Run: docker compose up
#   4. Visit https://localhost:4443
#
# Services:
#   - frontend: Static file server + HTTPS reverse proxy on port 4443
#   - tauth: Authentication service on port 8081

services:
  frontend:
    image: ghcr.io/tyemirov/ghttp:latest
    pull_policy: always
    depends_on:
      - tauth
    ports:
      - "4443:8443"
    env_file:
      - ./.env.ghttp
    volumes:
      - ./index.html:/app/index.html:ro
      - ./config.yaml:/app/config.yaml:ro
      - ./js:/app/js:ro
      - ./data:/app/data:ro
      - ./assets:/app/assets:ro
      - ./privacy:/app/privacy:ro
      - ./investors:/app/investors:ro
      - /media/share/Drive/exchange/certs/computercat/computercat-cert.pem:/certs/cert.pem:ro
      - /media/share/Drive/exchange/certs/computercat/computercat-key.pem:/certs/key.pem:ro
    restart: unless-stopped

  tauth:
    image: ghcr.io/tyemirov/tauth:latest
    pull_policy: always
    env_file:
      - ./.env.tauth
    ports:
      - "8081:8081"
    volumes:
      - tauth_data:/data
      - ./tauth-config.yaml:/config/config.yaml:ro
    command: ["--config", "/config/config.yaml"]
    restart: unless-stopped

volumes:
  tauth_data:
    name: prompt-bubbles-tauth-data
