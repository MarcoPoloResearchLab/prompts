<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Prompt Bubbles — Curated ChatGPT Prompts</title>
  <meta name="color-scheme" content="dark light" />
  <link rel="stylesheet" href="prompt-bubbles.css" />
</head>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R6J165F21E"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-R6J165F21E');
</script>

<body>
<div class="shell">
  <!-- Top search row -->
  <div class="topsearch">
    <div class="searchrow" role="region" aria-label="Search">
      <div class="searchbox">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M15.5 14h-.79l-.28-.27a6.471 6.471 0 0 0 1.57-4.23C15.99 6.01 13.48 3.5 10.49 3.5S5 6.01 5 9s2.51 5.5 5.5 5.5a6.47 6.47 0 0 0 4.23-1.57l.27.28v.79L20 20.49 21.49 19 15.5 14Zm-5 0C8.01 14 6 11.99 6 9.5S8.01 5 10.5 5 15 7.01 15 9.5 12.99 14 10.5 14Z"/></svg>
        <input id="searchInput" type="search" placeholder="Search prompts (title, text, tags)..." autocomplete="off" aria-label="Search prompts" />
        <button class="search-clear" id="clearSearch" title="Clear search" aria-label="Clear search">✕</button>
      </div>
    </div>
  </div>

  <header>
    <div class="titlebar" aria-label="Site header">
      <div class="logo" aria-hidden="true"></div>
      <h1>Prompt Bubbles</h1>
    </div>
    <p class="subtitle">A visually stunning, zero-backend gallery of copy-ready prompts.</p>
    <div class="chips" id="chipBar" aria-label="Tag filters"></div>
  </header>

  <main>
    <section class="grid" id="grid" role="list" aria-label="Prompt cards"></section>
    <p class="footer">Tip: Press <strong>/</strong> to jump to search • Press <strong>Enter</strong> on a focused card to copy</p>
  </main>
</div>

<script>
  let PROMPTS = [];
  const PROMPTS_PATH = "prompts.json";
  /** loadPrompts retrieves prompt data from a JSON file and assigns it to the global list */
  async function loadPrompts(){
    const response = await fetch(PROMPTS_PATH);
    const promptData = await response.json();
    PROMPTS = promptData;
  }

  // ====== STATE ======
  const state = { search:"", tag:"all" };

  const CLICK_EVENT = "click";
  const INPUT_EVENT = "input";
  const KEYDOWN_EVENT = "keydown";
  const TAG_CLASS = "tag";
  const SPAN_ELEMENT = "span";
  const DOM_CONTENT_LOADED_EVENT = "DOMContentLoaded";
  const BUTTON_CLASS = "btn";
  const SHARE_BUTTON_CLASS = "card-share";
  const ARIA_SHARE_LABEL = "Copy card link:";
  const HASH_SYMBOL = "#";
  /** placeholder constants for text inputs */
  const PLACEHOLDER_PATTERN = /\{([^}]+)\}/g;
  const PLACEHOLDER_ATTRIBUTE = "data-placeholder";
  const PLACEHOLDER_CLASS = "placeholder-input";
  const INPUT_ELEMENT = "input";
  const PLACEHOLDER_SELECTOR = INPUT_ELEMENT+"["+PLACEHOLDER_ATTRIBUTE+"]";

  // ====== HELPERS ======
  const $ = (s, r=document)=>r.querySelector(s);
  const $$ = (s, r=document)=>Array.from(r.querySelectorAll(s));
  const debounce=(fn,ms=120)=>{let t;return(...a)=>{clearTimeout(t);t=setTimeout(()=>fn(...a),ms)}};
  const sanitize=(s)=>s.replace(/\r/g,'');
  const matches=(item,q,tag)=>{
    const tagOk = tag==="all" || item.tags.includes(tag);
    if(!q) return tagOk;
    const hay=(item.title+" "+item.text+" "+item.tags.join(" ")).toLowerCase();
    return tagOk && q.split(/\s+/).every(tok=>hay.includes(tok));
  };

  /** renderPromptContent builds DOM nodes for prompt text and placeholders */
  function renderPromptContent(rawText){
    PLACEHOLDER_PATTERN.lastIndex=0;
    const fragment=document.createDocumentFragment();
    let cursorIndex=0; let matchResult;
    while((matchResult=PLACEHOLDER_PATTERN.exec(rawText))!==null){
      const precedingSegment=rawText.slice(cursorIndex, matchResult.index);
      if(precedingSegment) fragment.appendChild(document.createTextNode(precedingSegment));
      const placeholderName=matchResult[1];
      const placeholderInput=document.createElement(INPUT_ELEMENT);
      placeholderInput.className=PLACEHOLDER_CLASS;
      placeholderInput.setAttribute(PLACEHOLDER_ATTRIBUTE, placeholderName);
      placeholderInput.placeholder=placeholderName;
      placeholderInput.style.width=`${placeholderName.length}ch`;
      fragment.appendChild(placeholderInput);
      cursorIndex=PLACEHOLDER_PATTERN.lastIndex;
    }
    const trailingSegment=rawText.slice(cursorIndex);
    if(trailingSegment) fragment.appendChild(document.createTextNode(trailingSegment));
    return fragment;
  }

  /** resolvePlaceholders creates the final text for copying */
  function resolvePlaceholders(textElement){
    const clone=textElement.cloneNode(true);
    $$(PLACEHOLDER_SELECTOR, clone).forEach(inputElement=>{
      const placeholderName=inputElement.getAttribute(PLACEHOLDER_ATTRIBUTE);
      const userValue=inputElement.value || placeholderName;
      inputElement.replaceWith(userValue);
    });
    return clone.textContent;
  }

  // ====== RENDERING ======
  function uniqueTags(){
    const t=new Set(); PROMPTS.forEach(p=>p.tags.forEach(tag=>t.add(tag)));
    return ["all",...Array.from(t).sort((a,b)=>a.localeCompare(b))];
  }
  // renderChips shows filter chips for all unique tags.
  function renderChips(){
    const bar=$("#chipBar"); bar.innerHTML="";
    uniqueTags().forEach(tagName=>{
      const chip=document.createElement("button");
      chip.className="chip"; chip.type="button"; chip.textContent=tagName;
      chip.setAttribute("data-active", tagName===state.tag ? "true":"false");
      chip.onclick=()=>selectTag(tagName);
      bar.appendChild(chip);
    });
  }
  function highlightActiveChip(){ $$("#chipBar .chip").forEach(c=>c.setAttribute("data-active", String(c.textContent===state.tag))); }

  // selectTag updates the selected tag and refreshes the grid and chip states.
  function selectTag(tagName){
    state.tag=tagName;
    persist();
    renderGrid();
    highlightActiveChip();
  }

  function renderGrid(){
    const grid=$("#grid"); const q=state.search.trim().toLowerCase();
    const items=PROMPTS.filter(p=>matches(p,q,state.tag));
    grid.innerHTML="";
    items.forEach(item=>grid.appendChild(createCard(item)));
    if(items.length===0){ const p=document.createElement("p"); p.style.color="var(--text-1)"; p.style.gridColumn="1/-1"; p.textContent="No prompts match your search/filter."; grid.appendChild(p); }
  }

  // createCard builds a card for a prompt, wiring tag selection.
  function createCard(item){
    const card=document.createElement("article"); card.className="card"; card.id=item.id; card.setAttribute("role","listitem"); card.tabIndex=0;

    const header=document.createElement("div"); header.className="card-header";
    header.innerHTML=`<span class="tag-dot" aria-hidden="true"></span><h3 class="card-title">${escapeHTML(item.title)}</h3>`;
    card.appendChild(header);

    const tags=document.createElement("div"); tags.className="card-tags";
    item.tags.forEach(tagName=>{
      const tagElement=document.createElement(SPAN_ELEMENT);
      tagElement.className=TAG_CLASS;
      tagElement.textContent=tagName;
      tagElement.addEventListener(CLICK_EVENT,()=>selectTag(tagName));
      tags.appendChild(tagElement);
    });
    card.appendChild(tags);

    const text=document.createElement("pre");
    text.className="card-text";
    text.appendChild(renderPromptContent(item.text));
    card.appendChild(text);

    const actions=document.createElement("div"); actions.className="card-actions";
    const btn=document.createElement("button"); btn.className=BUTTON_CLASS; btn.type="button"; btn.setAttribute("aria-label",`Copy prompt: ${item.title}`);
    btn.innerHTML=copyIcon()+`<span>Copy</span>`; btn.onclick=()=>copyPrompt(card);
    actions.appendChild(btn); card.appendChild(actions);
    const shareButton=document.createElement("button"); shareButton.className=BUTTON_CLASS+" "+SHARE_BUTTON_CLASS; shareButton.type="button"; shareButton.setAttribute("aria-label",`${ARIA_SHARE_LABEL} ${item.title}`);
    shareButton.innerHTML=shareIcon(); shareButton.onclick=()=>copyCardUrl(card); card.appendChild(shareButton);

    const toast=document.createElement("div"); toast.className="copied"; toast.textContent="Copied ✓"; card.appendChild(toast);

    card.addEventListener("keydown",(e)=>{ if(e.key==="Enter"){ e.preventDefault(); copyPrompt(card); }});
    return card;
  }

  /** copyPrompt writes the card text with filled placeholders to the clipboard */
  function copyPrompt(card){
    const textElement=$(".card-text",card);
    const content=resolvePlaceholders(textElement).trim();
    navigator.clipboard.writeText(sanitize(content)).then(()=>{
      const toast=$(".copied",card); toast.setAttribute("data-show","true"); setTimeout(()=>toast.setAttribute("data-show","false"),1200);
    }).catch(()=>{
      const fallback=document.createElement("textarea");
      fallback.value=content;
      fallback.style.position="fixed";
      fallback.style.left="-9999px";
      document.body.appendChild(fallback);
      fallback.select();
      document.execCommand("copy");
      fallback.remove();
    });
  }
  /** copyCardUrl writes the card URL to the clipboard */
  function copyCardUrl(cardElement){
    const baseUrl=location.href.split(HASH_SYMBOL)[0];
    const cardUrl=baseUrl+HASH_SYMBOL+cardElement.id;
    navigator.clipboard.writeText(cardUrl).then(()=>{
      const toastElement=$(".copied",cardElement); toastElement.setAttribute("data-show","true"); setTimeout(()=>toastElement.setAttribute("data-show","false"),1200);
    }).catch(()=>{
      const fallbackInput=document.createElement("textarea");
      fallbackInput.value=cardUrl;
      fallbackInput.style.position="fixed";
      fallbackInput.style.left="-9999px";
      document.body.appendChild(fallbackInput);
      fallbackInput.select();
      document.execCommand("copy");
      fallbackInput.remove();
    });
  }
  function copyIcon(){ return `<svg viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v12h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>`; }
  function shareIcon(){ return `<svg viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.02-4.11A3 3 0 1 1 18 6a3 3 0 0 1-2.05-.81L8.94 9.23a3 3 0 1 0 0 5.54l7.01 4.1A3 3 0 1 1 18 16.08z"/></svg>`; }
  function escapeHTML(s){ return s.replace(/[&<>"']/g,ch=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[ch])); }

  // ====== SEARCH + PERSIST ======
  const onSearch = debounce((v)=>{ state.search=v; persist(); renderGrid(); },80);
  function persist(){ try{ localStorage.setItem("prompt-bubbles-state", JSON.stringify(state)); }catch{} }
  function restore(){ try{ const raw=localStorage.getItem("prompt-bubbles-state"); if(raw){ const p=JSON.parse(raw); if(typeof p.search==="string") state.search=p.search; if(typeof p.tag==="string") state.tag=p.tag; } }catch{} }

  /** init loads prompts and wires search interactions */
  async function init(){
    await loadPrompts();
    restore();
    renderChips();
    renderGrid();
    const searchInputElement=$("#searchInput"), clearSearchButton=$("#clearSearch");
    searchInputElement.value=state.search;
    searchInputElement.addEventListener(INPUT_EVENT, event=>onSearch(event.target.value));
    clearSearchButton.addEventListener(CLICK_EVENT,()=>{ searchInputElement.value=""; searchInputElement.focus(); onSearch(""); });
    window.addEventListener(KEYDOWN_EVENT, event=>{ if(event.key==="/" && document.activeElement!==searchInputElement){ event.preventDefault(); searchInputElement.focus(); searchInputElement.select(); }});
  }
  document.addEventListener(DOM_CONTENT_LOADED_EVENT, init);
</script>
</body>
</html>
